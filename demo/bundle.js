"use strict";

var _typeof47 = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _typeof46 = typeof Symbol === "function" && _typeof47(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof47(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof47(obj);
};

var _typeof45 = typeof Symbol === "function" && _typeof46(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof46(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof46(obj);
};

var _typeof44 = typeof Symbol === "function" && _typeof45(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof45(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof45(obj);
};

var _typeof43 = typeof Symbol === "function" && _typeof44(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof44(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof44(obj);
};

var _typeof42 = typeof Symbol === "function" && _typeof43(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof43(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof43(obj);
};

var _typeof41 = typeof Symbol === "function" && _typeof42(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof42(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof42(obj);
};

var _typeof40 = typeof Symbol === "function" && _typeof41(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof41(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof41(obj);
};

var _typeof39 = typeof Symbol === "function" && _typeof40(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof40(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof40(obj);
};

var _typeof38 = typeof Symbol === "function" && _typeof39(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof39(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof39(obj);
};

var _typeof37 = typeof Symbol === "function" && _typeof38(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof38(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof38(obj);
};

var _typeof36 = typeof Symbol === "function" && _typeof37(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof37(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof37(obj);
};

var _typeof35 = typeof Symbol === "function" && _typeof36(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof36(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof36(obj);
};

var _typeof34 = typeof Symbol === "function" && _typeof35(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof35(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof35(obj);
};

var _typeof33 = typeof Symbol === "function" && _typeof34(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof34(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof34(obj);
};

var _typeof32 = typeof Symbol === "function" && _typeof33(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof33(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof33(obj);
};

var _typeof31 = typeof Symbol === "function" && _typeof32(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof32(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof32(obj);
};

var _typeof30 = typeof Symbol === "function" && _typeof31(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof31(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof31(obj);
};

var _typeof29 = typeof Symbol === "function" && _typeof30(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof30(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof30(obj);
};

var _typeof28 = typeof Symbol === "function" && _typeof29(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof29(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof29(obj);
};

var _typeof27 = typeof Symbol === "function" && _typeof28(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof28(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof28(obj);
};

var _typeof26 = typeof Symbol === "function" && _typeof27(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof27(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof27(obj);
};

var _typeof25 = typeof Symbol === "function" && _typeof26(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof26(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof26(obj);
};

var _typeof24 = typeof Symbol === "function" && _typeof25(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof25(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof25(obj);
};

var _typeof23 = typeof Symbol === "function" && _typeof24(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof24(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof24(obj);
};

var _typeof22 = typeof Symbol === "function" && _typeof23(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof23(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof23(obj);
};

var _typeof21 = typeof Symbol === "function" && _typeof22(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof22(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof22(obj);
};

var _typeof20 = typeof Symbol === "function" && _typeof21(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof21(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof21(obj);
};

var _typeof19 = typeof Symbol === "function" && _typeof20(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof20(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof20(obj);
};

var _typeof18 = typeof Symbol === "function" && _typeof19(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof19(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof19(obj);
};

var _typeof17 = typeof Symbol === "function" && _typeof18(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof18(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof18(obj);
};

var _typeof16 = typeof Symbol === "function" && _typeof17(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof17(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof17(obj);
};

var _typeof15 = typeof Symbol === "function" && _typeof16(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof16(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof16(obj);
};

var _typeof14 = typeof Symbol === "function" && _typeof15(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof15(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof15(obj);
};

var _typeof13 = typeof Symbol === "function" && _typeof14(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof14(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof14(obj);
};

var _typeof12 = typeof Symbol === "function" && _typeof13(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof13(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof13(obj);
};

var _typeof11 = typeof Symbol === "function" && _typeof12(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof12(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof12(obj);
};

var _typeof10 = typeof Symbol === "function" && _typeof11(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof11(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof11(obj);
};

var _typeof9 = typeof Symbol === "function" && _typeof10(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof10(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof10(obj);
};

var _typeof8 = typeof Symbol === "function" && _typeof9(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof9(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof9(obj);
};

var _typeof7 = typeof Symbol === "function" && _typeof8(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof8(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof8(obj);
};

var _typeof6 = typeof Symbol === "function" && _typeof7(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof7(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof7(obj);
};

var _typeof5 = typeof Symbol === "function" && _typeof6(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof6(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof6(obj);
};

var _typeof4 = typeof Symbol === "function" && _typeof5(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof5(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof5(obj);
};

var _typeof3 = typeof Symbol === "function" && _typeof4(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof4(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof4(obj);
};

var _typeof2 = typeof Symbol === "function" && _typeof3(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof3(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof3(obj);
};

var _createClass = function () {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);
        }
    }return function (Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;
    };
}();

var _typeof = typeof Symbol === "function" && _typeof2(Symbol.iterator) === "symbol" ? function (obj) {
    return typeof obj === "undefined" ? "undefined" : _typeof2(obj);
} : function (obj) {
    return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof2(obj);
};

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }return call && ((typeof call === "undefined" ? "undefined" : _typeof2(call)) === "object" || typeof call === "function") ? call : self;
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + (typeof superClass === "undefined" ? "undefined" : _typeof2(superClass)));
    }subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
}

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

(function (f) {
    if ((typeof exports === "undefined" ? "undefined" : _typeof(exports)) === "object" && typeof module !== "undefined") {
        module.exports = f();
    } else if (typeof define === "function" && define.amd) {
        define([], f);
    } else {
        var g;if (typeof window !== "undefined") {
            g = window;
        } else if (typeof global !== "undefined") {
            g = global;
        } else if (typeof self !== "undefined") {
            g = self;
        } else {
            g = this;
        }g.Planner = f();
    }
})(function () {
    var define, module, exports;return function e(t, n, r) {
        function s(o, u) {
            if (!n[o]) {
                if (!t[o]) {
                    var a = typeof require == "function" && require;if (!u && a) return a(o, !0);if (i) return i(o, !0);var f = new Error("Cannot find module '" + o + "'");throw f.code = "MODULE_NOT_FOUND", f;
                }var l = n[o] = { exports: {} };t[o][0].call(l.exports, function (e) {
                    var n = t[o][1][e];return s(n ? n : e);
                }, l, l.exports, e, t, n, r);
            }return n[o].exports;
        }var i = typeof require == "function" && require;for (var o = 0; o < r.length; o++) {
            s(r[o]);
        }return s;
    }({ 1: [function (require, module, exports) {
            var Heap = require('../dist/heap.js');

            var AStar = function () {
                function AStar(heurFn, goalFn, succFn, costFn) {
                    _classCallCheck(this, AStar);

                    this.heurFn = heurFn;
                    this.goalFn = goalFn;
                    this.succFn = succFn;
                    this.costFn = costFn;
                }

                _createClass(AStar, [{
                    key: "_nodeify",
                    value: function _nodeify(data) {
                        var prev = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

                        data._astar_data = {
                            g: this.costFn(data),
                            h: this.heurFn(data, this.start),
                            prev: prev };
                        return data;
                    }
                }, {
                    key: "_step",
                    value: function _step() {
                        var _this = this;

                        var current = this.open.pop();
                        this.closed.push(current);

                        if (this.goalFn(current)) {
                            return this.traceback(current);
                        }

                        this.succFn(current).forEach(function (successor) {
                            if (_this.closed.indexOf(successor) < 0) {
                                if (_this.open.contains(successor)) {
                                    var tempCost = current._astar_data.g + successor._astar_data.g;
                                    if (tempCost < successor._astar_data.g) {
                                        successor._astar_data.g = tempCost;
                                        successor._astar_data.prev = current;
                                    }
                                } else {
                                    _this.open.push(_this._nodeify(successor, current));
                                }
                            }
                        });

                        if (this.open.size() == 0) {
                            return [];
                        }

                        return this._step();
                    }
                }, {
                    key: "find",
                    value: function find(start) {
                        this.start = start;
                        this.open = new Heap(function (node) {
                            return node._astar_data.g + node._astar_data.h;
                        });
                        this.closed = [];

                        this.open.push(this._nodeify(this.start));
                        return this._step();
                    }
                }, {
                    key: "traceback",
                    value: function traceback(goal) {
                        var path = [goal];
                        var trace = function trace(node) {
                            if (node._astar_data.prev) {
                                path.push(node._astar_data.prev);
                                trace(node._astar_data.prev);
                            }
                        };
                        trace(goal);
                        path.reverse();
                        return path.map(function (node) {
                            delete node._astar_data;
                            return node;
                        });
                    }
                }]);

                return AStar;
            }();

            module.exports = AStar;
        }, { "../dist/heap.js": 2 }], 2: [function (require, module, exports) {
            var Heap = function () {
                function Heap(scoreFn, compareFn) {
                    _classCallCheck(this, Heap);

                    this.contents = [];
                    this.scoreFn = scoreFn !== undefined ? scoreFn : function (x) {
                        return x;
                    };
                    this.compareFn = compareFn !== undefined ? compareFn : function (a, b) {
                        return a < b;
                    };
                }

                _createClass(Heap, [{
                    key: "toString",
                    value: function toString() {
                        return this.contents;
                    }
                }, {
                    key: "size",
                    value: function size() {
                        return this.contents.length;
                    }
                }, {
                    key: "contains",
                    value: function contains(item) {
                        return this.contents.indexOf(item) >= 0;
                    }
                }, {
                    key: "peek",
                    value: function peek() {
                        return this.contents[0];
                    }
                }, {
                    key: "push",
                    value: function push(nodes) {
                        var _this2 = this;

                        if (!Array.isArray(nodes)) {
                            nodes = [nodes];
                        }
                        nodes.forEach(function (node) {
                            _this2.contents.push(node);
                            _this2.bubbleUp(_this2.size() - 1);
                        });
                        return nodes;
                    }
                }, {
                    key: "pop",
                    value: function pop() {
                        var result = this.contents[0];
                        var end = this.contents.pop();

                        if (this.size() > 0) {
                            this.contents[0] = end;
                            this.sinkDown(0);
                        }

                        return result;
                    }
                }, {
                    key: "swap",
                    value: function swap(a, b) {
                        var t = this.contents[a];
                        this.contents[a] = this.contents[b];
                        this.contents[b] = t;
                        return a;
                    }
                }, {
                    key: "getIndexScore",
                    value: function getIndexScore(index) {
                        return this.scoreFn(this.contents[index]);
                    }
                }, {
                    key: "getParentIndex",
                    value: function getParentIndex(index) {
                        return Math.floor((index - 1) / 2);
                    }
                }, {
                    key: "bubbleUp",
                    value: function bubbleUp(index) {
                        if (index > 0) {
                            var parentIndex = this.getParentIndex(index);
                            if (this.compareFn(this.getIndexScore(index), this.getIndexScore(parentIndex))) {
                                this.bubbleUp(this.swap(parentIndex, index));
                            }
                        }
                    }
                }, {
                    key: "sinkDown",
                    value: function sinkDown(parentIndex) {
                        if (parentIndex < this.size()) {
                            var parentScore = this.getIndexScore(parentIndex);
                            var leftIndex = parentIndex * 2 + 1;
                            var rightIndex = parentIndex * 2 + 2;
                            var swapIdx;

                            if (leftIndex < this.size()) {
                                var _leftIndexScore = this.getIndexScore(leftIndex);
                                if (this.compareFn(_leftIndexScore, parentScore)) {
                                    swapIdx = leftIndex;
                                }
                            }

                            if (rightIndex < this.size()) {
                                var rightIndexScore = this.getIndexScore(rightIndex);
                                if (this.compareFn(rightIndexScore, swapIdx !== undefined ? leftIndexScore : parentScore)) {
                                    swapIdx = rightIndex;
                                }
                            }

                            if (swapIdx !== undefined) {
                                this.sinkDown(this.swap(swapIdx, parentIndex));
                            }
                        }
                    }
                }]);

                return Heap;
            }();

            module.exports = Heap;
        }, {}], 3: [function (require, module, exports) {
            var AStar = require('../dist/astar.js');
            var Heap = require('../dist/heap.js');

            var GOAP = function () {
                function GOAP(agent) {
                    _classCallCheck(this, GOAP);

                    this.agent = agent;
                }

                _createClass(GOAP, [{
                    key: "formulate",
                    value: function formulate() {
                        var _this3 = this;

                        var goal = this.agent.getGoal();
                        var finalActions = [];

                        console.log('Formulating plan for ' + goal);

                        // TODO allow for composite of actions to accomplish goal
                        this.agent.actions.forEach(function (action) {
                            if (action.satisfies(goal)) {
                                finalActions.push(action);
                            }
                        });

                        if (finalActions.length === 0) {
                            return [];
                        }

                        var heurFn = function heurFn(node, root) {
                            return 0;
                        };
                        var goalFn = function goalFn(node) {
                            return _this3.agent.stateSatisfies(node);
                        };
                        var succFn = function succFn(node) {
                            return node.chain;
                        };
                        var costFn = function costFn(node) {
                            return node.cost;
                        };

                        console.log('Starting search with action ' + finalActions[0]);

                        var planner = new AStar(heurFn, goalFn, succFn, costFn);
                        var path = planner.find(finalActions.pop());
                        path.reverse();

                        if (path.length === 0) {
                            console.log('No plan found!');
                        } else {
                            console.log('Plan:');
                            path.forEach(function (action) {
                                return console.log('\t' + action);
                            });
                        }
                    }
                }]);

                return GOAP;
            }();

            var Agent = function () {
                function Agent() {
                    _classCallCheck(this, Agent);

                    this.planner = new GOAP(this);
                    this.goals = new Heap();
                    this.actions = [];
                    this.state = {};
                }

                _createClass(Agent, [{
                    key: "getGoal",
                    value: function getGoal() {
                        return this.goals.peek();
                    }
                }, {
                    key: "addAction",
                    value: function addAction(anAction) {
                        this.actions.forEach(function (action) {
                            if (anAction.satisfies(action)) {
                                action.chain.push(anAction);
                            }
                            if (action.satisfies(anAction)) {
                                anAction.chain.push(action);
                            }
                        });

                        this.actions.push(anAction);
                    }
                }, {
                    key: "stateSatisfies",
                    value: function stateSatisfies(anIntermediateState) {
                        var targetState = anIntermediateState.conditions;

                        for (var tsKey in targetState) {
                            var tsValue = targetState[tsKey];

                            if (this.state[tsKey] != tsValue) {
                                return false;
                            }
                        }

                        return true;
                    }
                }, {
                    key: "getPlan",
                    value: function getPlan() {
                        return this.planner.formulate();
                    }
                }]);

                return Agent;
            }();

            var IntermediateState = function () {
                function IntermediateState(key) {
                    var conditions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

                    _classCallCheck(this, IntermediateState);

                    this.key = key;
                    this.conditions = conditions;
                }

                _createClass(IntermediateState, [{
                    key: "toString",
                    value: function toString() {
                        return this.key;
                    }
                }, {
                    key: "satisfies",
                    value: function satisfies(anIntermediateState) {
                        return new Error('An IntermediateState must implement @satisfies( anIntermediateState ).');
                    }
                }, {
                    key: "clone",
                    value: function clone() {
                        return new Error('An IntermediateState must implement @clone().');
                    }
                }]);

                return IntermediateState;
            }();

            var Action = function (_IntermediateState) {
                _inherits(Action, _IntermediateState);

                function Action(key) {
                    var conditions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
                    var effects = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
                    var cost = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;

                    _classCallCheck(this, Action);

                    var _this4 = _possibleConstructorReturn(this, (Action.__proto__ || Object.getPrototypeOf(Action)).call(this, key, conditions));

                    _this4.effects = effects;
                    _this4.cost = cost;
                    _this4.chain = [];
                    return _this4;
                }

                _createClass(Action, [{
                    key: "satisfies",
                    value: function satisfies(anIntermediateState) {
                        var state = anIntermediateState.conditions;

                        for (var eKey in this.effects) {
                            var eVal = this.effects[eKey];

                            for (var sKey in state) {
                                var sVal = state[sKey];

                                if (eKey == sKey && eVal == sVal) {
                                    return true;
                                }
                            }
                        }

                        return false;
                    }
                }, {
                    key: "clone",
                    value: function clone() {
                        return Object.assign(new Action(), this);
                    }
                }]);

                return Action;
            }(IntermediateState);

            var Goal = function (_IntermediateState2) {
                _inherits(Goal, _IntermediateState2);

                function Goal(key) {
                    var conditions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
                    var priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;

                    _classCallCheck(this, Goal);

                    var _this5 = _possibleConstructorReturn(this, (Goal.__proto__ || Object.getPrototypeOf(Goal)).call(this, key, conditions));

                    _this5.priority = priority;
                    return _this5;
                }

                _createClass(Goal, [{
                    key: "clone",
                    value: function clone() {
                        return Object.assign(new Goal(), this);
                    }
                }]);

                return Goal;
            }(IntermediateState);

            module.exports = {
                GOAP: GOAP,
                Agent: Agent,
                Action: Action,
                Goal: Goal };
        }, { "../dist/astar.js": 1, "../dist/heap.js": 2 }] }, {}, [3])(3);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJ1bmRsZS5qcyJdLCJuYW1lcyI6WyJmIiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsImciLCJ3aW5kb3ciLCJnbG9iYWwiLCJzZWxmIiwiUGxhbm5lciIsImUiLCJ0IiwibiIsInIiLCJzIiwibyIsInUiLCJhIiwicmVxdWlyZSIsImkiLCJFcnJvciIsImNvZGUiLCJsIiwiY2FsbCIsImxlbmd0aCIsIkhlYXAiLCJBU3RhciIsImNvbnN0cnVjdG9yIiwiaGV1ckZuIiwiZ29hbEZuIiwic3VjY0ZuIiwiY29zdEZuIiwiX25vZGVpZnkiLCJkYXRhIiwicHJldiIsIl9hc3Rhcl9kYXRhIiwiaCIsInN0YXJ0IiwiX3N0ZXAiLCJjdXJyZW50Iiwib3BlbiIsInBvcCIsImNsb3NlZCIsInB1c2giLCJ0cmFjZWJhY2siLCJmb3JFYWNoIiwic3VjY2Vzc29yIiwiaW5kZXhPZiIsImNvbnRhaW5zIiwidGVtcENvc3QiLCJzaXplIiwiZmluZCIsIm5vZGUiLCJnb2FsIiwicGF0aCIsInRyYWNlIiwicmV2ZXJzZSIsIm1hcCIsInNjb3JlRm4iLCJjb21wYXJlRm4iLCJjb250ZW50cyIsInVuZGVmaW5lZCIsIngiLCJiIiwidG9TdHJpbmciLCJpdGVtIiwicGVlayIsIm5vZGVzIiwiQXJyYXkiLCJpc0FycmF5IiwiYnViYmxlVXAiLCJyZXN1bHQiLCJlbmQiLCJzaW5rRG93biIsInN3YXAiLCJnZXRJbmRleFNjb3JlIiwiaW5kZXgiLCJnZXRQYXJlbnRJbmRleCIsIk1hdGgiLCJmbG9vciIsInBhcmVudEluZGV4IiwicGFyZW50U2NvcmUiLCJsZWZ0SW5kZXgiLCJyaWdodEluZGV4Iiwic3dhcElkeCIsImxlZnRJbmRleFNjb3JlIiwicmlnaHRJbmRleFNjb3JlIiwiR09BUCIsImFnZW50IiwiZm9ybXVsYXRlIiwiZ2V0R29hbCIsImZpbmFsQWN0aW9ucyIsImNvbnNvbGUiLCJsb2ciLCJhY3Rpb25zIiwiYWN0aW9uIiwic2F0aXNmaWVzIiwicm9vdCIsInN0YXRlU2F0aXNmaWVzIiwiY2hhaW4iLCJjb3N0IiwicGxhbm5lciIsIkFnZW50IiwiZ29hbHMiLCJzdGF0ZSIsImFkZEFjdGlvbiIsImFuQWN0aW9uIiwiYW5JbnRlcm1lZGlhdGVTdGF0ZSIsInRhcmdldFN0YXRlIiwiY29uZGl0aW9ucyIsInRzS2V5IiwidHNWYWx1ZSIsImdldFBsYW4iLCJJbnRlcm1lZGlhdGVTdGF0ZSIsImtleSIsImNsb25lIiwiQWN0aW9uIiwiZWZmZWN0cyIsImVLZXkiLCJlVmFsIiwic0tleSIsInNWYWwiLCJPYmplY3QiLCJhc3NpZ24iLCJHb2FsIiwicHJpb3JpdHkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsQ0FBQyxVQUFBLEFBQVMsR0FBRSxBQUFDO1FBQUcsUUFBQSxBQUFPLDhEQUFQLEFBQWlCLFlBQVUsT0FBQSxBQUFPLFdBQXJDLEFBQThDLGFBQVksQUFBQztlQUFBLEFBQU8sVUFBbEUsQUFBMkQsQUFBZSxBQUFJO2VBQVEsT0FBQSxBQUFPLFdBQVAsQUFBZ0IsY0FBWSxPQUEvQixBQUFzQyxLQUFJLEFBQUM7ZUFBQSxBQUFPLElBQWxELEFBQTJDLEFBQVUsQUFBRztXQUFJLEFBQUM7WUFBQSxBQUFJLE1BQUssT0FBQSxBQUFPLFdBQVYsQUFBbUIsYUFBWSxBQUFDO2dCQUFoQyxBQUFnQyxBQUFFLEFBQU87bUJBQVEs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QUFRLFFBQVEsUUFBcEIsQUFBNEIsTUFBTSxBQUM5QjsyQ0FBQSxBQUFPLEFBQ1YsQUFDSixBQUNKLEFBRUQ7Ozs7OytCQUFBLEFBQU8sQUFDVixBQUVEOzs7OzRDQUFRLEFBQ0o7K0JBQU8sT0FBQSxBQUFPLE9BQU8sSUFBZCxBQUFjLEFBQUksVUEzQk0sQUFDbkMsQUEwQkksQUFBTyxBQUE0QixBQUN0QyxBQUdMOzs7OztjQS9CQSxBQUFxQjs7Z0JBK0JyQixBQUFNOzs7OEJBQ0YsQUFBWSxLQUFvQyxBQUM1Qzt3QkFEYSxpRkFBakIsQUFBOEI7d0JBQUksK0VBQWxDLEFBQTZDOzs7OzZIQUN6QyxBQUFNLEtBQU4sQUFBVyxBQUNYOzsyQkFBQSxBQUFLLFdBQUwsQUFBZ0IsQUFDbkIsQUFFRDs7Ozs7OzRDQUFRLEFBQ0o7K0JBQU8sT0FBQSxBQUFPLE9BQU8sSUFBZCxBQUFjLEFBQUksUUFQSSxBQUNqQyxBQU1JLEFBQU8sQUFBMEIsQUFDcEMsQUFHTDs7Ozs7Y0FYQSxBQUFtQjs7bUJBV25CLEFBQU87c0JBQVUsQUFDYixBQUFNLEFBQ047dUJBRmEsQUFFTixBQUNQO3dCQUhhLEFBR0wsQUFDUjtzQkEzSkksQUF1SlIsQUFBaUIsQUFJUCxBQUVUO1dBQUMsRUFBQyxvQkFBRCxBQUFvQixHQUFFLG1CQTlVdVYsQUFBMmIsQUFpTGx5QixBQTZKTixBQUF3QyxRQTlVcVUsQUE4VWhVLElBQUcsQ0E5VTZULEFBOFU3VCxBQUFDLElBOVVuRCxBQUF3VyxBQUFPLEFBOFV4VCxBQUN0RCIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oZil7aWYodHlwZW9mIGV4cG9ydHM9PT1cIm9iamVjdFwiJiZ0eXBlb2YgbW9kdWxlIT09XCJ1bmRlZmluZWRcIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PVwiZnVuY3Rpb25cIiYmZGVmaW5lLmFtZCl7ZGVmaW5lKFtdLGYpfWVsc2V7dmFyIGc7aWYodHlwZW9mIHdpbmRvdyE9PVwidW5kZWZpbmVkXCIpe2c9d2luZG93fWVsc2UgaWYodHlwZW9mIGdsb2JhbCE9PVwidW5kZWZpbmVkXCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT1cInVuZGVmaW5lZFwiKXtnPXNlbGZ9ZWxzZXtnPXRoaXN9Zy5QbGFubmVyID0gZigpfX0pKGZ1bmN0aW9uKCl7dmFyIGRlZmluZSxtb2R1bGUsZXhwb3J0cztyZXR1cm4gKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuY29uc3QgSGVhcCA9IHJlcXVpcmUoJy4uL2Rpc3QvaGVhcC5qcycpO1xuXG5jbGFzcyBBU3RhciB7XG4gICAgY29uc3RydWN0b3IoaGV1ckZuLCBnb2FsRm4sIHN1Y2NGbiwgY29zdEZuKSB7XG4gICAgICAgIHRoaXMuaGV1ckZuID0gaGV1ckZuO1xuICAgICAgICB0aGlzLmdvYWxGbiA9IGdvYWxGbjtcbiAgICAgICAgdGhpcy5zdWNjRm4gPSBzdWNjRm47XG4gICAgICAgIHRoaXMuY29zdEZuID0gY29zdEZuO1xuICAgIH1cblxuICAgIF9ub2RlaWZ5KGRhdGEsIHByZXYgPSBudWxsKSB7XG4gICAgICAgIGRhdGEuX2FzdGFyX2RhdGEgPSB7XG4gICAgICAgICAgICBnOiB0aGlzLmNvc3RGbihkYXRhKSxcbiAgICAgICAgICAgIGg6IHRoaXMuaGV1ckZuKGRhdGEsIHRoaXMuc3RhcnQpLFxuICAgICAgICAgICAgcHJldjogcHJldiB9O1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG5cbiAgICBfc3RlcCgpIHtcbiAgICAgICAgbGV0IGN1cnJlbnQgPSB0aGlzLm9wZW4ucG9wKCk7XG4gICAgICAgIHRoaXMuY2xvc2VkLnB1c2goY3VycmVudCk7XG5cbiAgICAgICAgaWYgKHRoaXMuZ29hbEZuKGN1cnJlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50cmFjZWJhY2soY3VycmVudCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnN1Y2NGbihjdXJyZW50KS5mb3JFYWNoKHN1Y2Nlc3NvciA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5jbG9zZWQuaW5kZXhPZihzdWNjZXNzb3IpIDwgMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wZW4uY29udGFpbnMoc3VjY2Vzc29yKSkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcENvc3QgPSBjdXJyZW50Ll9hc3Rhcl9kYXRhLmcgKyBzdWNjZXNzb3IuX2FzdGFyX2RhdGEuZztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXBDb3N0IDwgc3VjY2Vzc29yLl9hc3Rhcl9kYXRhLmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3Nvci5fYXN0YXJfZGF0YS5nID0gdGVtcENvc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzb3IuX2FzdGFyX2RhdGEucHJldiA9IGN1cnJlbnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW4ucHVzaCh0aGlzLl9ub2RlaWZ5KHN1Y2Nlc3NvciwgY3VycmVudCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRoaXMub3Blbi5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0ZXAoKTtcbiAgICB9XG5cbiAgICBmaW5kKHN0YXJ0KSB7XG4gICAgICAgIHRoaXMuc3RhcnQgPSBzdGFydDtcbiAgICAgICAgdGhpcy5vcGVuID0gbmV3IEhlYXAobm9kZSA9PiBub2RlLl9hc3Rhcl9kYXRhLmcgKyBub2RlLl9hc3Rhcl9kYXRhLmgpO1xuICAgICAgICB0aGlzLmNsb3NlZCA9IFtdO1xuXG4gICAgICAgIHRoaXMub3Blbi5wdXNoKHRoaXMuX25vZGVpZnkodGhpcy5zdGFydCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RlcCgpO1xuICAgIH1cblxuICAgIHRyYWNlYmFjayhnb2FsKSB7XG4gICAgICAgIGxldCBwYXRoID0gW2dvYWxdO1xuICAgICAgICBsZXQgdHJhY2UgPSBub2RlID0+IHtcbiAgICAgICAgICAgIGlmIChub2RlLl9hc3Rhcl9kYXRhLnByZXYpIHtcbiAgICAgICAgICAgICAgICBwYXRoLnB1c2gobm9kZS5fYXN0YXJfZGF0YS5wcmV2KTtcbiAgICAgICAgICAgICAgICB0cmFjZShub2RlLl9hc3Rhcl9kYXRhLnByZXYpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0cmFjZShnb2FsKTtcbiAgICAgICAgcGF0aC5yZXZlcnNlKCk7XG4gICAgICAgIHJldHVybiBwYXRoLm1hcChub2RlID0+IHtcbiAgICAgICAgICAgIGRlbGV0ZSBub2RlLl9hc3Rhcl9kYXRhO1xuICAgICAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBU3RhcjtcblxufSx7XCIuLi9kaXN0L2hlYXAuanNcIjoyfV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG5jbGFzcyBIZWFwIHtcbiAgY29uc3RydWN0b3Ioc2NvcmVGbiwgY29tcGFyZUZuKSB7XG4gICAgdGhpcy5jb250ZW50cyA9IFtdO1xuICAgIHRoaXMuc2NvcmVGbiA9IHNjb3JlRm4gIT09IHVuZGVmaW5lZCA/IHNjb3JlRm4gOiB4ID0+IHg7XG4gICAgdGhpcy5jb21wYXJlRm4gPSBjb21wYXJlRm4gIT09IHVuZGVmaW5lZCA/IGNvbXBhcmVGbiA6IChhLCBiKSA9PiBhIDwgYjtcbiAgfVxuXG4gIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiB0aGlzLmNvbnRlbnRzO1xuICB9XG5cbiAgc2l6ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5jb250ZW50cy5sZW5ndGg7XG4gIH1cblxuICBjb250YWlucyhpdGVtKSB7XG4gICAgcmV0dXJuIHRoaXMuY29udGVudHMuaW5kZXhPZihpdGVtKSA+PSAwO1xuICB9XG5cbiAgcGVlaygpIHtcbiAgICByZXR1cm4gdGhpcy5jb250ZW50c1swXTtcbiAgfVxuXG4gIHB1c2gobm9kZXMpIHtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkobm9kZXMpKSB7XG4gICAgICBub2RlcyA9IFtub2Rlc107XG4gICAgfVxuICAgIG5vZGVzLmZvckVhY2gobm9kZSA9PiB7XG4gICAgICB0aGlzLmNvbnRlbnRzLnB1c2gobm9kZSk7XG4gICAgICB0aGlzLmJ1YmJsZVVwKHRoaXMuc2l6ZSgpIC0gMSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIG5vZGVzO1xuICB9XG5cbiAgcG9wKCkge1xuICAgIGxldCByZXN1bHQgPSB0aGlzLmNvbnRlbnRzWzBdO1xuICAgIGxldCBlbmQgPSB0aGlzLmNvbnRlbnRzLnBvcCgpO1xuXG4gICAgaWYgKHRoaXMuc2l6ZSgpID4gMCkge1xuICAgICAgdGhpcy5jb250ZW50c1swXSA9IGVuZDtcbiAgICAgIHRoaXMuc2lua0Rvd24oMCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHN3YXAoYSwgYikge1xuICAgIGNvbnN0IHQgPSB0aGlzLmNvbnRlbnRzW2FdO1xuICAgIHRoaXMuY29udGVudHNbYV0gPSB0aGlzLmNvbnRlbnRzW2JdO1xuICAgIHRoaXMuY29udGVudHNbYl0gPSB0O1xuICAgIHJldHVybiBhO1xuICB9XG5cbiAgZ2V0SW5kZXhTY29yZShpbmRleCkge1xuICAgIHJldHVybiB0aGlzLnNjb3JlRm4odGhpcy5jb250ZW50c1tpbmRleF0pO1xuICB9XG5cbiAgZ2V0UGFyZW50SW5kZXgoaW5kZXgpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcigoaW5kZXggLSAxKSAvIDIpO1xuICB9XG5cbiAgYnViYmxlVXAoaW5kZXgpIHtcbiAgICBpZiAoaW5kZXggPiAwKSB7XG4gICAgICBjb25zdCBwYXJlbnRJbmRleCA9IHRoaXMuZ2V0UGFyZW50SW5kZXgoaW5kZXgpO1xuICAgICAgaWYgKHRoaXMuY29tcGFyZUZuKHRoaXMuZ2V0SW5kZXhTY29yZShpbmRleCksIHRoaXMuZ2V0SW5kZXhTY29yZShwYXJlbnRJbmRleCkpKSB7XG4gICAgICAgIHRoaXMuYnViYmxlVXAodGhpcy5zd2FwKHBhcmVudEluZGV4LCBpbmRleCkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHNpbmtEb3duKHBhcmVudEluZGV4KSB7XG4gICAgaWYgKHBhcmVudEluZGV4IDwgdGhpcy5zaXplKCkpIHtcbiAgICAgIGNvbnN0IHBhcmVudFNjb3JlID0gdGhpcy5nZXRJbmRleFNjb3JlKHBhcmVudEluZGV4KTtcbiAgICAgIGNvbnN0IGxlZnRJbmRleCA9IHBhcmVudEluZGV4ICogMiArIDE7XG4gICAgICBjb25zdCByaWdodEluZGV4ID0gcGFyZW50SW5kZXggKiAyICsgMjtcbiAgICAgIHZhciBzd2FwSWR4O1xuXG4gICAgICBpZiAobGVmdEluZGV4IDwgdGhpcy5zaXplKCkpIHtcbiAgICAgICAgY29uc3QgbGVmdEluZGV4U2NvcmUgPSB0aGlzLmdldEluZGV4U2NvcmUobGVmdEluZGV4KTtcbiAgICAgICAgaWYgKHRoaXMuY29tcGFyZUZuKGxlZnRJbmRleFNjb3JlLCBwYXJlbnRTY29yZSkpIHtcbiAgICAgICAgICBzd2FwSWR4ID0gbGVmdEluZGV4O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChyaWdodEluZGV4IDwgdGhpcy5zaXplKCkpIHtcbiAgICAgICAgY29uc3QgcmlnaHRJbmRleFNjb3JlID0gdGhpcy5nZXRJbmRleFNjb3JlKHJpZ2h0SW5kZXgpO1xuICAgICAgICBpZiAodGhpcy5jb21wYXJlRm4ocmlnaHRJbmRleFNjb3JlLCBzd2FwSWR4ICE9PSB1bmRlZmluZWQgPyBsZWZ0SW5kZXhTY29yZSA6IHBhcmVudFNjb3JlKSkge1xuICAgICAgICAgIHN3YXBJZHggPSByaWdodEluZGV4O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChzd2FwSWR4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5zaW5rRG93bih0aGlzLnN3YXAoc3dhcElkeCwgcGFyZW50SW5kZXgpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBIZWFwO1xuXG59LHt9XSwzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbmNvbnN0IEFTdGFyID0gcmVxdWlyZSgnLi4vZGlzdC9hc3Rhci5qcycpO1xuY29uc3QgSGVhcCA9IHJlcXVpcmUoJy4uL2Rpc3QvaGVhcC5qcycpO1xuXG5jbGFzcyBHT0FQIHtcbiAgICBjb25zdHJ1Y3RvcihhZ2VudCkge1xuICAgICAgICB0aGlzLmFnZW50ID0gYWdlbnQ7XG4gICAgfVxuXG4gICAgZm9ybXVsYXRlKCkge1xuICAgICAgICBsZXQgZ29hbCA9IHRoaXMuYWdlbnQuZ2V0R29hbCgpO1xuICAgICAgICBsZXQgZmluYWxBY3Rpb25zID0gW107XG5cbiAgICAgICAgY29uc29sZS5sb2coJ0Zvcm11bGF0aW5nIHBsYW4gZm9yICcgKyBnb2FsKTtcblxuICAgICAgICAvLyBUT0RPIGFsbG93IGZvciBjb21wb3NpdGUgb2YgYWN0aW9ucyB0byBhY2NvbXBsaXNoIGdvYWxcbiAgICAgICAgdGhpcy5hZ2VudC5hY3Rpb25zLmZvckVhY2goYWN0aW9uID0+IHtcbiAgICAgICAgICAgIGlmIChhY3Rpb24uc2F0aXNmaWVzKGdvYWwpKSB7XG4gICAgICAgICAgICAgICAgZmluYWxBY3Rpb25zLnB1c2goYWN0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGZpbmFsQWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBoZXVyRm4gPSAobm9kZSwgcm9vdCkgPT4gMDtcbiAgICAgICAgbGV0IGdvYWxGbiA9IG5vZGUgPT4gdGhpcy5hZ2VudC5zdGF0ZVNhdGlzZmllcyhub2RlKTtcbiAgICAgICAgbGV0IHN1Y2NGbiA9IG5vZGUgPT4gbm9kZS5jaGFpbjtcbiAgICAgICAgbGV0IGNvc3RGbiA9IG5vZGUgPT4gbm9kZS5jb3N0O1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdTdGFydGluZyBzZWFyY2ggd2l0aCBhY3Rpb24gJyArIGZpbmFsQWN0aW9uc1swXSk7XG5cbiAgICAgICAgbGV0IHBsYW5uZXIgPSBuZXcgQVN0YXIoaGV1ckZuLCBnb2FsRm4sIHN1Y2NGbiwgY29zdEZuKTtcbiAgICAgICAgbGV0IHBhdGggPSBwbGFubmVyLmZpbmQoZmluYWxBY3Rpb25zLnBvcCgpKTtcbiAgICAgICAgcGF0aC5yZXZlcnNlKCk7XG5cbiAgICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTm8gcGxhbiBmb3VuZCEnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQbGFuOicpO1xuICAgICAgICAgICAgcGF0aC5mb3JFYWNoKGFjdGlvbiA9PiBjb25zb2xlLmxvZygnXFx0JyArIGFjdGlvbikpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5jbGFzcyBBZ2VudCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucGxhbm5lciA9IG5ldyBHT0FQKHRoaXMpO1xuICAgICAgICB0aGlzLmdvYWxzID0gbmV3IEhlYXAoKTtcbiAgICAgICAgdGhpcy5hY3Rpb25zID0gW107XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7fTtcbiAgICB9XG5cbiAgICBnZXRHb2FsKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nb2Fscy5wZWVrKCk7XG4gICAgfVxuXG4gICAgYWRkQWN0aW9uKGFuQWN0aW9uKSB7XG4gICAgICAgIHRoaXMuYWN0aW9ucy5mb3JFYWNoKGFjdGlvbiA9PiB7XG4gICAgICAgICAgICBpZiAoYW5BY3Rpb24uc2F0aXNmaWVzKGFjdGlvbikpIHtcbiAgICAgICAgICAgICAgICBhY3Rpb24uY2hhaW4ucHVzaChhbkFjdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYWN0aW9uLnNhdGlzZmllcyhhbkFjdGlvbikpIHtcbiAgICAgICAgICAgICAgICBhbkFjdGlvbi5jaGFpbi5wdXNoKGFjdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWN0aW9ucy5wdXNoKGFuQWN0aW9uKTtcbiAgICB9XG5cbiAgICBzdGF0ZVNhdGlzZmllcyhhbkludGVybWVkaWF0ZVN0YXRlKSB7XG4gICAgICAgIGxldCB0YXJnZXRTdGF0ZSA9IGFuSW50ZXJtZWRpYXRlU3RhdGUuY29uZGl0aW9ucztcblxuICAgICAgICBmb3IgKGxldCB0c0tleSBpbiB0YXJnZXRTdGF0ZSkge1xuICAgICAgICAgICAgbGV0IHRzVmFsdWUgPSB0YXJnZXRTdGF0ZVt0c0tleV07XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlW3RzS2V5XSAhPSB0c1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgZ2V0UGxhbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGxhbm5lci5mb3JtdWxhdGUoKTtcbiAgICB9XG59XG5cbmNsYXNzIEludGVybWVkaWF0ZVN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihrZXksIGNvbmRpdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLmtleSA9IGtleTtcbiAgICAgICAgdGhpcy5jb25kaXRpb25zID0gY29uZGl0aW9ucztcbiAgICB9XG5cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMua2V5O1xuICAgIH1cblxuICAgIHNhdGlzZmllcyhhbkludGVybWVkaWF0ZVN0YXRlKSB7XG4gICAgICAgIHJldHVybiBuZXcgRXJyb3IoJ0FuIEludGVybWVkaWF0ZVN0YXRlIG11c3QgaW1wbGVtZW50IEBzYXRpc2ZpZXMoIGFuSW50ZXJtZWRpYXRlU3RhdGUgKS4nKTtcbiAgICB9XG5cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBFcnJvcignQW4gSW50ZXJtZWRpYXRlU3RhdGUgbXVzdCBpbXBsZW1lbnQgQGNsb25lKCkuJyk7XG4gICAgfVxufVxuXG5jbGFzcyBBY3Rpb24gZXh0ZW5kcyBJbnRlcm1lZGlhdGVTdGF0ZSB7XG4gICAgY29uc3RydWN0b3Ioa2V5LCBjb25kaXRpb25zID0ge30sIGVmZmVjdHMgPSB7fSwgY29zdCA9IDApIHtcbiAgICAgICAgc3VwZXIoa2V5LCBjb25kaXRpb25zKTtcbiAgICAgICAgdGhpcy5lZmZlY3RzID0gZWZmZWN0cztcbiAgICAgICAgdGhpcy5jb3N0ID0gY29zdDtcbiAgICAgICAgdGhpcy5jaGFpbiA9IFtdO1xuICAgIH1cblxuICAgIHNhdGlzZmllcyhhbkludGVybWVkaWF0ZVN0YXRlKSB7XG4gICAgICAgIGxldCBzdGF0ZSA9IGFuSW50ZXJtZWRpYXRlU3RhdGUuY29uZGl0aW9ucztcblxuICAgICAgICBmb3IgKGxldCBlS2V5IGluIHRoaXMuZWZmZWN0cykge1xuICAgICAgICAgICAgbGV0IGVWYWwgPSB0aGlzLmVmZmVjdHNbZUtleV07XG5cbiAgICAgICAgICAgIGZvciAobGV0IHNLZXkgaW4gc3RhdGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgc1ZhbCA9IHN0YXRlW3NLZXldO1xuXG4gICAgICAgICAgICAgICAgaWYgKGVLZXkgPT0gc0tleSAmJiBlVmFsID09IHNWYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihuZXcgQWN0aW9uKCksIHRoaXMpO1xuICAgIH1cbn1cblxuY2xhc3MgR29hbCBleHRlbmRzIEludGVybWVkaWF0ZVN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihrZXksIGNvbmRpdGlvbnMgPSB7fSwgcHJpb3JpdHkgPSAwKSB7XG4gICAgICAgIHN1cGVyKGtleSwgY29uZGl0aW9ucyk7XG4gICAgICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICB9XG5cbiAgICBjbG9uZSgpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24obmV3IEdvYWwoKSwgdGhpcyk7XG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBHT0FQOiBHT0FQLFxuICAgIEFnZW50OiBBZ2VudCxcbiAgICBBY3Rpb246IEFjdGlvbixcbiAgICBHb2FsOiBHb2FsIH07XG5cbn0se1wiLi4vZGlzdC9hc3Rhci5qc1wiOjEsXCIuLi9kaXN0L2hlYXAuanNcIjoyfV19LHt9LFszXSkoMylcbn0pOyJdfQ==